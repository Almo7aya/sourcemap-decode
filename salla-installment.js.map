{"file":"salla-installment.js","mappings":"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","names":["SallaInstallment"],"sources":["./src/components/salla-installment/salla-installment.scss?tag=salla-installment","./src/components/salla-installment/salla-installment.tsx"],"sourcesContent":["/*\n  The whole installment methods is a third-party widgets,\n  So there aren't a custom classes (as other components) to style them.\n*/\n\nsalla-installment:empty {\n  display: none;\n}\n/*\n* Installment::Tabby\n*/\n#tabbyPromoWrapper {\n  background: white;\n  border-radius: 0.375rem;\n  transition: box-shadow 0.5s cubic-bezier(0.4, 0, 0.2, 1);\n  margin-bottom: 20px;\n\n  .salla-y &{\n    border: 1px solid var(--color-grey-dark);\n    border-radius: 12px\n  }\n\n  &:hover{\n    box-shadow: 0 0 #0000, 0 0 #0000, 5px 10px 30px #2B2D340D;\n  }\n\n  #tabbyPromo {\n    * {\n      font-family: var(--font-main);\n    }\n\n    > div > div {\n      max-width: none;\n      //padding: 15px;\n      box-shadow: none;\n      border: none;\n    }\n\n    .tabby-promo-snippet {\n      max-width: 100%;\n      min-height: 100px;\n      padding: 18px 20px;\n      // border-color: var(--color-grey-dark);\n      border: none !important;\n\n\n      &__text, &__link {\n        font-size: var(--font-sm);\n        color: var(--color-text) !important;\n      }\n\n      &__link {\n        font-weight: bold;\n      }\n    }\n  }\n}\n\n.tabby-promo-wrapper {\n  #tabby-promo {\n    font-family: var(--font-main) !important;\n\n    .tabby-promo {\n      &__feature-title {\n        font-size: var(--font-md);\n      }\n\n      &__feature-desc {\n        font-size: var(--font-sm);\n        line-height: 20px;\n      }\n    }\n  }\n}\n\n/*\n* Installment::Tamara & Spotii\n*/\n.tamara-product-widget{\n  margin-bottom: 20px;\n}\n\n.tamara-product-widget,\n.spotii-wrapper {\n  min-height: 100px;\n  position: relative;\n  color: var(--color-text);\n  font-size: var(--font-sm);\n  line-height: 1.25;\n  padding: 18px 20px 18px 100px !important;\n  background: white;\n  border-radius: 0.375rem;\n  transition: box-shadow 0.5s cubic-bezier(0.4, 0, 0.2, 1);\n\n  .salla-y &{\n    border-radius: 12px;\n    border: 1px solid var(--color-grey-dark);\n  }\n\n  &:hover{\n    box-shadow: 0 0 #0000, 0 0 #0000, 5px 10px 30px #2B2D340D;\n  }\n  .spotii-logo {\n    float: left;\n    margin: 0 0 0 -75px;\n  }\n}\n.ltr .tamara-product-widget,\n.ltr .spotii-wrapper{\n  text-align: left;\n  padding: 18px 100px 18px 20px !important;\n  .spotii-logo {\n    float: right;\n    margin: 0 -75px 0 0;\n  }\n  .spotii-product-widget {\n    text-align: left !important;\n  }\n}\n\n.spotii-wrapper {\n  margin-bottom: 20px;\n  .spotii-promo {\n    font-size: var(--font-md);\n  }\n\n  .spotii-product-widget {\n    font-size: var(--font-sm) !important;\n    margin-top: 10px;\n  }\n}\n\n.tamara-product-widget{\n  .tamara-logo {\n    position: absolute;\n    left: 20px;\n    top: 18px;\n    margin: 0 !important;\n\n    .ltr &{\n      right: 20px;\n      left: auto;\n    }\n  }\n\n  span {\n    font-family: var(--font-main);\n    font-size: var(--font-sm);\n    color: var(--color-text);\n\n    &:last-child {\n      display: block;\n      position: relative;\n      margin-top: 8px;\n    }\n  }\n}\n\n.tamara-popup {\n  &__wrap {\n    overflow: auto !important;\n  }\n}\n","import { Component, Host, h, Prop, State, Element } from '@stencil/core';\n\n@Component({\n  tag: 'salla-installment',\n  styleUrl: 'salla-installment.scss',\n})\n\nexport class SallaInstallment {\n  private tabbyBorderRemoved: boolean = false;\n  private tabbyRemoveBorderTries: number = 0;\n  @Element() host: HTMLElement;\n  constructor() {\n    salla.lang.onLoaded(() => {\n      const installment = salla.config.get('store.settings.installments');\n      if (installment) {\n        this.tamaraIsActive = installment.includes('tamara_installment');\n        this.tabbyIsActive = installment.includes('tabby_installment');\n        this.spotiiIsActive = installment.includes('spotii_pay');\n      }\n      this.renderInstallments();\n    });\n\n    salla.event.on('product::price.updated', ({ data }) => {\n      if (!data.price || data.price == this.price) {\n        return;\n      }\n      this.price = data.price;\n      this.renderInstallments(true);\n    });\n  }\n\n  /**\n   * Current product price\n   */\n  @Prop() price: string;\n  /**\n   * Language code\n   */\n  @Prop() language: string = salla.config.get('user.language_code');\n  /**\n   * Currency code\n   */\n  @Prop() currency: string = salla.config.get('user.currency_code');\n\n  @State() tamaraIsActive: boolean;\n  @State() tabbyIsActive: boolean;\n  @State() spotiiIsActive: boolean;\n\n  render() {\n    return (\n      <Host>\n        {this.tamaraIsActive ?\n          <div class=\"tamara-product-widget\"\n            data-price={this.price}\n            data-currency={this.currency}\n            data-lang={this.language}\n            data-payment-type=\"installment\">\n          </div>\n          : ''}\n\n        {this.tabbyIsActive ?\n          <div id=\"tabbyPromoWrapper\">\n            <div id=\"tabbyPromo\"></div>\n          </div>\n          : ''}\n\n        {this.spotiiIsActive ?\n          <div class=\"spotii-wrapper\">\n            {/*No need for the price, the price already in the page, and also tammara & tabby doesn't have price */}\n            <div class=\"spotii-promo\"></div>\n          </div>\n          : ''}\n      </Host>\n    );\n  }\n\n  renderInstallments(isUpdating: boolean = false) {\n    // Tamara\n    if (this.tamaraIsActive) {\n      if (isUpdating) {\n        var oldTamaraScript = document.querySelector('script[src=\"https://cdn.tamara.co/widget/product-widget.min.js\"]');\n        if (oldTamaraScript) {\n          oldTamaraScript.remove();\n        }\n      }\n\n      var tamaraScript = document.createElement('script');\n      tamaraScript.setAttribute('src', 'https://cdn.tamara.co/widget/product-widget.min.js');\n      document.head.appendChild(tamaraScript);\n      tamaraScript.onload = () => {\n        window.TamaraProductWidget.init({ lang: this.language });\n        setTimeout(() => {\n          window.TamaraProductWidget.render();\n        }, 300);\n      };\n    }\n\n    // tabby\n    if (this.tabbyIsActive) {\n      if (isUpdating) {\n\n        // remove #tabbyPromoWrapper and re append it\n        var oldTabbyWrapper = this.host.querySelector('#tabbyPromoWrapper');\n        if (oldTabbyWrapper) {\n          oldTabbyWrapper.remove();\n        }\n\n        var tabbyPromoWrapper = document.createElement('div');\n        tabbyPromoWrapper.setAttribute('id', 'tabbyPromoWrapper');\n        var tabbyPromo = document.createElement('div');\n        tabbyPromo.setAttribute('id', 'tabbyPromo');\n        tabbyPromoWrapper.appendChild(tabbyPromo);\n        this.host.appendChild(tabbyPromoWrapper);\n\n        var oldTabbyScript = document.querySelector('script[src=\"https://checkout.tabby.ai/tabby-promo.js\"]');\n        if (oldTabbyScript) {\n          oldTabbyScript.remove();\n        }\n      }\n\n      var tabbyScript = document.createElement('script');\n      tabbyScript.setAttribute('src', 'https://checkout.tabby.ai/tabby-promo.js');\n      document.head.appendChild(tabbyScript);\n      tabbyScript.onload = () => {\n        const TabbyPromo = window.TabbyPromo;\n        new TabbyPromo({\n          selector: '#tabbyPromo',\n          currency: this.currency,\n          price: this.price,\n          lang: this.language,\n        });\n        document.querySelectorAll('.tabby-promo-snippet__logo').forEach(function (element) {\n          element.setAttribute('aria-label', 'Tabby Logo');\n        });\n      }\n      // this is a workaround to remove the default border and add margin\n      this.removeTabbyBorder();\n    }\n\n    // Spotii\n    if (this.spotiiIsActive) {\n      if (isUpdating) {\n\n        var oldSpotiiWrapper = this.host.querySelector('.spotii-wrapper');\n        if (oldSpotiiWrapper) {\n          oldSpotiiWrapper.remove();\n        }\n\n        var spotiiPromoWrapper = document.createElement('div');\n        spotiiPromoWrapper.classList.add('spotii-wrapper');\n        var spotiiPromo = document.createElement('div');\n        spotiiPromo.classList.add('spotii-promo');\n        spotiiPromoWrapper.appendChild(spotiiPromo);\n        this.host.appendChild(spotiiPromoWrapper);\n        var oldSpotiiScript = document.querySelector('script[src=\"' + salla.url.cdn('js/price-widget-ar-salla.js') + '\"]');\n        if (oldSpotiiScript) {\n          oldSpotiiScript.remove();\n        }\n      }\n\n      let amount = salla.money((Number(this.price) / 3).toFixed(2));\n      let isRTL = salla.config.get('theme.is_rtl', true);\n      window.spotiiConfig = {\n        targetXPath: ['.spotii-wrapper'],\n        renderToPath: ['.spotii-promo'],\n        numberOfPayment: 3,\n        currency: this.currency,\n        templateLine: \"${textOne} ${number} ${textTwo} \" + amount + \"${logo} ${info}\",\n        //todo:: translate these\n        textOne: isRTL ? \"جزء الدفع على\" : \"Split it into\",\n        textTwo: isRTL ? \"أقساط متساوية بدون تكاليف اضافية بقيمة\" : \"payments of\",\n        textThree: \"مع\",\n        price: this.price,\n        // forcedShow: false,\n        // merchantID: null,\n      };\n\n      var spotiiScript = document.createElement('script');\n      spotiiScript.setAttribute('src', salla.url.cdn('js/price-widget-ar-salla.js'));\n      document.head.appendChild(spotiiScript);\n      // spotiiScript.onload = () => {\n      //   // setTimeout()\n      // }\n    }\n  }\n\n\n  /**\n   * this is workaround to remove the default border and add margin\n   * we will try to remove tabby border 5 times for 7.5 seconds\n   */\n  removeTabbyBorder() {\n    if (this.tabbyBorderRemoved || this.tabbyRemoveBorderTries > 5) {\n      return;\n    }\n    this.tabbyRemoveBorderTries++;\n    setTimeout(() => {\n      let promo: any = document.querySelector('#tabbyPromo>div>div');\n      promo = promo ? promo.shadowRoot.querySelector('div[class^=\"styles__tabby-promo-snippet--\"]') : null;\n      if (promo) {\n        promo.style = 'border: none; margin: 15px 0!important;';\n        this.tabbyBorderRemoved = true;\n      } else {\n        this.removeTabbyBorder();\n      }\n    }, this.tabbyRemoveBorderTries * 500)\n  }\n}\n"],"version":3}